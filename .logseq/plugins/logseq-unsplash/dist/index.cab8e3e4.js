!function(){var e,t,n,r,s={},o=t={};function i(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function c(e){if(n===setTimeout)return setTimeout(e,0);if((n===i||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:i}catch(e){n=i}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(e){r=a}}();var l,u=[],d=!1,h=-1;function p(){d&&l&&(d=!1,l.length?u=l.concat(u):h=-1,u.length&&f())}function f(){if(!d){var e=c(p);d=!0;for(var t=u.length;t;){for(l=u,u=[];++h<t;)l&&l[h].run();h=-1,t=u.length}l=null,d=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function g(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new m(e,t)),1!==u.length||d||c(f)},m.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=g,o.addListener=g,o.once=g,o.off=g,o.removeListener=g,o.removeAllListeners=g,o.emit=g,o.prependListener=g,o.prependOnceListener=g,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0};var y,v,w=t;
/*! For license information please see lsplugin.user.js.LICENSE.txt*/y=self,v=function(){return(()=>{var e={227:(e,t,n)=>{t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;t.splice(1,0,n,"color: inherit");let r=0,s=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(r++,"%c"===e&&(s=r))})),t.splice(s,0,n)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}return!e&&void 0!==w&&"env"in w&&(e=void 0),e},t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=n(447)(t);const{formatters:r}=e.exports;r.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},447:(e,t,n)=>{e.exports=function(e){function t(e){let n,s=null;function o(...e){if(!o.enabled)return;const r=o,s=Number(new Date),i=s-(n||s);r.diff=i,r.prev=n,r.curr=s,n=s,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let a=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((n,s)=>{if("%%"===n)return"%";a++;const o=t.formatters[s];if("function"==typeof o){const t=e[a];n=o.call(r,t),e.splice(a,1),a--}return n})),t.formatArgs.call(r,e),(r.log||t.log).apply(r,e)}return o.namespace=e,o.useColors=t.useColors(),o.color=t.selectColor(e),o.extend=r,o.destroy=t.destroy,Object.defineProperty(o,"enabled",{enumerable:!0,configurable:!1,get:()=>null===s?t.enabled(e):s,set:e=>{s=e}}),"function"==typeof t.init&&t.init(o),o}function r(e,n){const r=t(this.namespace+(void 0===n?":":n)+e);return r.log=this.log,r}function s(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){const e=[...t.names.map(s),...t.skips.map(s).map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){let n;t.save(e),t.names=[],t.skips=[];const r=("string"==typeof e?e:"").split(/[\s,]+/),s=r.length;for(n=0;n<s;n++)r[n]&&("-"===(e=r[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=n(824),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((n=>{t[n]=e[n]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let n=0;for(let t=0;t<e.length;t++)n=(n<<5)-n+e.charCodeAt(t),n|=0;return t.colors[Math.abs(n)%t.colors.length]},t.enable(t.load()),t}},729:e=>{var t=Object.prototype.hasOwnProperty,n="~";function r(){}function s(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function o(e,t,r,o,i){if("function"!=typeof r)throw new TypeError("The listener must be a function");var a=new s(r,o||e,i),c=n?n+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],a]:e._events[c].push(a):(e._events[c]=a,e._eventsCount++),e}function i(e,t){0==--e._eventsCount?e._events=new r:delete e._events[t]}function a(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),a.prototype.eventNames=function(){var e,r,s=[];if(0===this._eventsCount)return s;for(r in e=this._events)t.call(e,r)&&s.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?s.concat(Object.getOwnPropertySymbols(e)):s},a.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var s=0,o=r.length,i=new Array(o);s<o;s++)i[s]=r[s].fn;return i},a.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},a.prototype.emit=function(e,t,r,s,o,i){var a=n?n+e:e;if(!this._events[a])return!1;var c,l,u=this._events[a],d=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),d){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,r),!0;case 4:return u.fn.call(u.context,t,r,s),!0;case 5:return u.fn.call(u.context,t,r,s,o),!0;case 6:return u.fn.call(u.context,t,r,s,o,i),!0}for(l=1,c=new Array(d-1);l<d;l++)c[l-1]=arguments[l];u.fn.apply(u.context,c)}else{var h,p=u.length;for(l=0;l<p;l++)switch(u[l].once&&this.removeListener(e,u[l].fn,void 0,!0),d){case 1:u[l].fn.call(u[l].context);break;case 2:u[l].fn.call(u[l].context,t);break;case 3:u[l].fn.call(u[l].context,t,r);break;case 4:u[l].fn.call(u[l].context,t,r,s);break;default:if(!c)for(h=1,c=new Array(d-1);h<d;h++)c[h-1]=arguments[h];u[l].fn.apply(u[l].context,c)}}return!0},a.prototype.on=function(e,t,n){return o(this,e,t,n,!1)},a.prototype.once=function(e,t,n){return o(this,e,t,n,!0)},a.prototype.removeListener=function(e,t,r,s){var o=n?n+e:e;if(!this._events[o])return this;if(!t)return i(this,o),this;var a=this._events[o];if(a.fn)a.fn!==t||s&&!a.once||r&&a.context!==r||i(this,o);else{for(var c=0,l=[],u=a.length;c<u;c++)(a[c].fn!==t||s&&!a[c].once||r&&a[c].context!==r)&&l.push(a[c]);l.length?this._events[o]=1===l.length?l[0]:l:i(this,o)}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&i(this,t)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=n,a.EventEmitter=a,e.exports=a},824:e=>{var t=1e3,n=60*t,r=60*n,s=24*r;function o(e,t,n,r){var s=t>=1.5*n;return Math.round(e/n)+" "+r+(s?"s":"")}e.exports=function(e,i){i=i||{};var a,c,l=typeof e;if("string"===l&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var o=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(o){var i=parseFloat(o[1]);switch((o[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*i;case"weeks":case"week":case"w":return 6048e5*i;case"days":case"day":case"d":return i*s;case"hours":case"hour":case"hrs":case"hr":case"h":return i*r;case"minutes":case"minute":case"mins":case"min":case"m":return i*n;case"seconds":case"second":case"secs":case"sec":case"s":return i*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return i;default:return}}}}(e);if("number"===l&&isFinite(e))return i.long?(a=e,(c=Math.abs(a))>=s?o(a,c,s,"day"):c>=r?o(a,c,r,"hour"):c>=n?o(a,c,n,"minute"):c>=t?o(a,c,t,"second"):a+" ms"):function(e){var o=Math.abs(e);return o>=s?Math.round(e/s)+"d":o>=r?Math.round(e/r)+"h":o>=n?Math.round(e/n)+"m":o>=t?Math.round(e/t)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}}},t={};function n(r){if(t[r])return t[r].exports;var s=t[r]={exports:{}};return e[r](s,s.exports,n),s.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};return(()=>{function e(e){return e===Object(e)&&!Array.isArray(e)}function t(n,...r){if(!r.length)return n;const s=n;if(e(s)){const n=r.length;for(let o=0;o<n;o+=1){const n=r[o];if(e(n))for(const r in n)n.hasOwnProperty(r)&&(e(n[r])?(s[r]&&e(s[r])||(s[r]={}),t(s[r],n[r])):Array.isArray(s[r])&&Array.isArray(n[r])?s[r]=Array.from(new Set(s[r].concat(n[r]))):s[r]=n[r])}}return s}function s(e,t){let n,r,s=!1;const o=t=>n=>{e&&clearTimeout(e),t(n),s=!0},i=new Promise(((s,i)=>{n=o(s),r=o(i),e&&(e=setTimeout((()=>r(new Error(`[deferred timeout] ${t}`))),e))}));return{created:Date.now(),setTag:e=>t=e,resolve:n,reject:r,promise:i,get settled(){return s}}}n.r(r),n.d(r,{LSPluginUser:()=>U,setupPluginUserInstance:()=>$});var o="application/x-postmate-v1+json",i=0,a={handshake:1,"handshake-reply":1,call:1,emit:1,reply:1,request:1},c=function(e,t){return!("string"==typeof t&&e.origin!==t||!e.data||"object"==typeof e.data&&!("postmate"in e.data)||e.data.type!==o||!a[e.data.postmate])},l=function(){function e(e){var t=this;this.parent=e.parent,this.frame=e.frame,this.child=e.child,this.childOrigin=e.childOrigin,this.events={},this.listener=function(e){if(!c(e,t.childOrigin))return!1;var n=((e||{}).data||{}).value||{},r=n.data,s=n.name;"emit"===e.data.postmate&&s in t.events&&t.events[s].call(t,r)},this.parent.addEventListener("message",this.listener,!1)}var t=e.prototype;return t.get=function(e){var t=this;return new d.Promise((function(n){var r=++i;t.parent.addEventListener("message",(function e(s){s.data.uid===r&&"reply"===s.data.postmate&&(t.parent.removeEventListener("message",e,!1),n(s.data.value))}),!1),t.child.postMessage({postmate:"request",type:o,property:e,uid:r},t.childOrigin)}))},t.call=function(e,t){this.child.postMessage({postmate:"call",type:o,property:e,data:t},this.childOrigin)},t.on=function(e,t){this.events[e]=t},t.destroy=function(){window.removeEventListener("message",this.listener,!1),this.frame.parentNode.removeChild(this.frame)},e}(),u=function(){function e(e){var t=this;this.model=e.model,this.parent=e.parent,this.parentOrigin=e.parentOrigin,this.child=e.child,this.child.addEventListener("message",(function(e){if(c(e,t.parentOrigin)){var n=e.data,r=n.property,s=n.uid,i=n.data;"call"!==e.data.postmate?function(e,t){var n="function"==typeof e[t]?e[t]():e[t];return d.Promise.resolve(n)}(t.model,r).then((function(t){return e.source.postMessage({property:r,postmate:"reply",type:o,uid:s,value:t},e.origin)})):r in t.model&&"function"==typeof t.model[r]&&t.model[r](i)}}))}return e.prototype.emit=function(e,t){this.parent.postMessage({postmate:"emit",type:o,value:{name:e,data:t}},this.parentOrigin)},e}(),d=function(){function e(e){var t=e.container,n=void 0===t?void 0!==n?n:document.body:t,r=e.model,s=e.url,o=e.name,i=e.classListArray,a=void 0===i?[]:i;return this.parent=window,this.frame=document.createElement("iframe"),this.frame.name=o||"",this.frame.classList.add.apply(this.frame.classList,a),n.appendChild(this.frame),this.child=this.frame.contentWindow||this.frame.contentDocument.parentWindow,this.model=r||{},this.sendHandshake(s)}return e.prototype.sendHandshake=function(t){var n,r=this,s=function(e){var t=document.createElement("a");t.href=e;var n=t.protocol.length>4?t.protocol:window.location.protocol,r=t.host.length?"80"===t.port||"443"===t.port?t.hostname:t.host:window.location.host;return t.origin||n+"//"+r}(t),i=0;return new e.Promise((function(e,a){r.parent.addEventListener("message",(function t(o){return!!c(o,s)&&("handshake-reply"===o.data.postmate?(clearInterval(n),r.parent.removeEventListener("message",t,!1),r.childOrigin=o.origin,e(new l(r))):a("Failed handshake"))}),!1);var u=function(){i++,r.child.postMessage({postmate:"handshake",type:o,model:r.model},s),5===i&&clearInterval(n)},d=function(){u(),n=setInterval(u,500)};r.frame.attachEvent?r.frame.attachEvent("onload",d):r.frame.onload=d,r.frame.src=t}))},e}();d.debug=!1,d.Promise=function(){try{return window?window.Promise:Promise}catch(e){return null}}(),d.Model=function(){function e(e){return this.child=window,this.model=e,this.parent=this.child.parent,this.sendHandshakeReply()}return e.prototype.sendHandshakeReply=function(){var e=this;return new d.Promise((function(t,n){e.child.addEventListener("message",(function r(s){if(s.data.postmate){if("handshake"===s.data.postmate){e.child.removeEventListener("message",r,!1),s.source.postMessage({postmate:"handshake-reply",type:o},s.origin),e.parentOrigin=s.origin;var i=s.data.model;return i&&Object.keys(i).forEach((function(t){e.model[t]=i[t]})),t(new u(e))}return n("Handshake Reply Failed")}}),!1)}))},e}();const h=d;var p=n(729),f=n.n(p),m=n(227),g=n.n(m);const{importHTML:y,createSandboxContainer:v}=window.QSandbox||{};function w(e,t){return e.startsWith("http")?fetch(e,t):(e=e.replace("file://",""),new Promise((async(t,n)=>{try{const n=await window.apis.doAction(["readFile",e]);t({text:()=>n})}catch(e){console.error(e),n(e)}})))}class C extends(f()){constructor(e){super(),this._pluginLocal=e,this._loaded=!1,this._unmountFns=[],e._dispose((()=>{this._unmount()}))}async load(){const{name:e,entry:t}=this._pluginLocal.options;if(this.loaded||!t)return;const{template:n,execScripts:r}=await y(t,{fetch:w});this._mount(n,document.body);const s=v(e,{elementGetter:()=>this._root?.firstChild}).instance.proxy;s.__shadow_mode__=!0,s.LSPluginLocal=this._pluginLocal,s.LSPluginShadow=this,s.LSPluginUser=s.logseq=new U(this._pluginLocal.toJSON(),this._pluginLocal.caller);const o=await r(s,!0);this._unmountFns.push(o.unmount),this._loaded=!0}_mount(e,t){const n=this._frame=document.createElement("div");n.classList.add("lsp-shadow-sandbox"),n.id=this._pluginLocal.id,this._root=n.attachShadow({mode:"open"}),this._root.innerHTML=`<div>${e}</div>`,t.appendChild(n),this.emit("mounted")}_unmount(){for(const e of this._unmountFns)e&&e.call(null)}destroy(){this.frame?.parentNode?.removeChild?.(this.frame)}get loaded(){return this._loaded}get document(){return this._root?.firstChild}get frame(){return this._frame}}const _=g()("LSPlugin:caller"),b="#await#response#",F="#lspmsg#error#",L=e=>`#lspmsg#${e}`;class x extends(f()){constructor(e){super(),this._pluginLocal=e,this._connected=!1,this._userModel={},this._debugTag="",e&&(this._debugTag=e.debugTag)}async connectToChild(){if(this._connected)return;const{shadow:e}=this._pluginLocal;e?await this._setupShadowSandbox():await this._setupIframeSandbox()}async connectToParent(e={}){if(this._connected)return;const t=this,n=null!=this._pluginLocal;let r=0,o=0;const i=new Map,a=s(5e3),c=this._extendUserModel({"#lspmsg#ready#":async()=>{await a.resolve()},"#lspmsg#beforeunload#":async e=>{const n=s(1e4);t.emit("beforeunload",Object.assign({actor:n},e)),await n.promise},"#lspmsg#settings#":async({type:e,payload:n})=>{t.emit("settings:changed",n)},"#lspmsg#":async({ns:e,type:n,payload:r})=>{_(`${this._debugTag} [call from host]`,e,n,r),e&&e.startsWith("hook")?t.emit(`${e}:${n}`,r):t.emit(n,r)},"#lspmsg#reply#":({_sync:e,result:t})=>{if(_(`sync reply #${e}`,t),i.has(e)){const n=i.get(e);n&&(t?.hasOwnProperty?.(F)?n.reject(t[F]):n.resolve(t),i.delete(e))}},...e});if(n)return await a.promise,JSON.parse(JSON.stringify(this._pluginLocal?.toJSON?.()));const l=new h.Model(c);return this._status="pending",await l.then((e=>{this._child=e,this._connected=!0,this._call=async(t,n={},r)=>{if(r){const e=++o;i.set(e,r),n._sync=e,r.setTag(`async call #${e}`),_("async call #",e)}return e.emit(L(c.baseInfo.id),{type:t,payload:n}),r?.promise},this._callUserModel=async(e,t)=>{try{c[e](t)}catch(t){_(`model method #${e} not existed`)}},r=setInterval((()=>{if(i.size>100)for(const[e,t]of i)t.settled&&i.delete(e)}),18e5)})).finally((()=>{this._status=void 0})),await a.promise,c.baseInfo}async call(e,t={}){return this._call?.call?.(this,e,t)}async callAsync(e,t={}){const n=s(1e4);return this._call?.call?.(this,e,t,n)}async callUserModel(e,t={}){return this._callUserModel?.call?.(this,e,t)}async _setupIframeSandbox(){const e=this._pluginLocal,t=new h({container:document.body,url:e.options.entry,classListArray:["lsp-iframe-sandbox"],model:{baseInfo:JSON.parse(JSON.stringify(e.toJSON()))}});let n;return this._status="pending",new Promise(((r,s)=>{n=setTimeout((()=>{s(new Error("handshake Timeout"))}),3e3),t.then((t=>{this._parent=t,this._connected=!0,this.emit("connected"),t.frame.setAttribute("id",e.id),t.on(L(e.id),(({type:e,payload:t})=>{_("[call from plugin] ",e,t),this._pluginLocal?.emit?.(e,t||{})})),this._call=async(...n)=>{await t.call(L(e.id),{type:n[0],payload:n[1]||{}})},this._callUserModel=async(e,n)=>{if(e.startsWith(b))return await t.get(e.replace(b,""));t.call(e,n)},r(null)})).catch((e=>{s(e)})).finally((()=>{clearTimeout(n)}))})).catch((e=>{throw _("iframe sandbox error",e),e})).finally((()=>{this._status=void 0}))}async _setupShadowSandbox(){const e=this._pluginLocal,t=this._shadow=new C(e);try{this._status="pending",await t.load(),this._connected=!0,this.emit("connected"),this._call=async(e,t={},n)=>(n&&(t.actor=n),this._pluginLocal?.emit?.(e,t),n?.promise),this._callUserModel=async(...e)=>{let t=e[0];t?.startsWith?.(b)&&(t=t.replace(b,""));const n=e[1]||{},r=this._userModel[t];"function"==typeof r&&await r.call(null,n)}}catch(e){throw _("shadow sandbox error",e),e}finally{this._status=void 0}}_extendUserModel(e){return Object.assign(this._userModel,e)}_getSandboxIframeContainer(){return this._parent?.frame}_getSandboxShadowContainer(){return this._shadow?.frame}set debugTag(e){this._debugTag=e}async destroy(){this._parent&&await this._parent.destroy(),this._shadow&&this._shadow.destroy()}}var S=function(){return(S=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)};function k(e){return e.toLowerCase()}Object.create,Object.create;var E=[/([a-z0-9])([A-Z])/g,/([A-Z])([A-Z][a-z])/g],M=/[^A-Z0-9]+/gi;function O(e,t,n){return t instanceof RegExp?e.replace(t,n):t.reduce((function(e,t){return e.replace(t,n)}),e)}const T=g()("LSPlugin:user"),I={};let A=0;const P={registerSlashCommand:function(e,t){return T("Register slash command #",this.baseInfo.id,e,t),"function"==typeof t&&(t=[["editor/clear-current-slash",!1],["editor/restore-saved-cursor"],["editor/hook",t]]),t=t.map((e=>{const[t,...n]=e;switch(t){case"editor/hook":let r=n[0],s=()=>{this.caller?.callUserModel?.(r)};"function"==typeof r&&(s=r);const o=`SlashCommandHook${t}${++A}`;e[1]=o,this.Editor["on"+o](s)}return e})),this.caller?.call?.("api:call",{method:"register-plugin-slash-command",args:[this.baseInfo.id,[e,t]]}),!1},registerBlockContextMenu:function(e,t){if("function"!=typeof t)return!1;const n=e,r=e,s=`SimpleCommandHook${e}${++A}`;return this.Editor["on"+s](t),this.caller?.call?.("api:call",{method:"register-plugin-simple-command",args:[this.baseInfo.id,[{key:n,label:r,type:"block-context-menu"},["editor/hook",s]]]}),!1}},j={};class U extends(f()){constructor(e,t){super(),this._baseInfo=e,this._caller=t,this._connected=!1,this._ui=new Map,t.on("settings:changed",(e=>{const t=Object.assign({},this.settings),n=Object.assign(this._baseInfo.settings,e);this.emit("settings:changed",{...n},t)})),t.on("beforeunload",(async e=>{const{actor:n,...r}=e,s=this._beforeunloadCallback;try{s&&await s(r),n?.resolve?.(null)}catch(e){console.debug(`${t.debugTag} [beforeunload] `,e),n?.reject?.(e)}}))}async ready(e,n){if(!this._connected)try{"function"==typeof e&&(n=e,e={});let r=await this._caller.connectToParent(e);r=t(this._baseInfo,r),this._connected=!0,r?.id&&(this._caller.debugTag=`#${r.id} [${r.name}]`),n&&n.call(this,r)}catch(e){console.error("[LSPlugin Ready Error]",e)}}beforeunload(e){"function"==typeof e&&(this._beforeunloadCallback=e)}provideModel(e){return this.caller._extendUserModel(e),this}provideTheme(e){return this.caller.call("provider:theme",e),this}provideStyle(e){return this.caller.call("provider:style",e),this}provideUI(e){return this.caller.call("provider:ui",e),this}updateSettings(e){this.caller.call("settings:update",e)}setMainUIAttrs(e){this.caller.call("main-ui:attrs",e)}setMainUIInlineStyle(e){this.caller.call("main-ui:style",e)}hideMainUI(e){const t={key:0,visible:!1,cursor:e?.restoreEditingCursor};this.caller.call("main-ui:visible",t),this.emit("ui:visible:changed",t),this._ui.set(t.key,t)}showMainUI(){const e={key:0,visible:!0};this.caller.call("main-ui:visible",e),this.emit("ui:visible:changed",e),this._ui.set(e.key,e)}toggleMainUI(){const e=this._ui.get(0);e&&e.visible?this.hideMainUI():this.showMainUI()}get isMainUIVisible(){const e=this._ui.get(0);return Boolean(e&&e.visible)}get connected(){return this._connected}get baseInfo(){return this._baseInfo}get settings(){return this.baseInfo?.settings}get caller(){return this._caller}_makeUserProxy(e,t){const n=this,r=this.caller;return new Proxy(e,{get:function(e,s,o){const i=e[s];return function(...e){if(!i||!1!==i.apply(n,e)){if(t){const n=s.toString().match(/^(once|off|on)/i);if(null!=n){const s=n[0].toLowerCase(),i=n.input.slice(s.length),c=`hook:${t}:${o=i,void 0===a&&(a={}),function(e,t){return void 0===t&&(t={}),function(e,t){void 0===t&&(t={});for(var n=t.splitRegexp,r=void 0===n?E:n,s=t.stripRegexp,o=void 0===s?M:s,i=t.transform,a=void 0===i?k:i,c=t.delimiter,l=void 0===c?" ":c,u=O(O(e,r,"$1\0$2"),o,"\0"),d=0,h=u.length;"\0"===u.charAt(d);)d++;for(;"\0"===u.charAt(h-1);)h--;return u.slice(d,h).split("\0").map(a).join(l)}(e,S({delimiter:"."},t))}(o,S({delimiter:"_"},a))}`,l=e[0];return r[s](c,l),"off"!==s?()=>r.off(c,l):void 0}}var o,a;return r.callAsync("api:call",{method:s,args:e})}}}})}get App(){return this._makeUserProxy(I,"app")}get Editor(){return this._makeUserProxy(P,"editor")}get DB(){return this._makeUserProxy(j)}}function $(e,t){return new U(e,t)}if(null==window.__LSP__HOST__){const e=new x(null);window.logseq=$({},e)}})(),r})()},"object"==typeof s?s=v():"object"==typeof s?(e=v(),s.LSPluginEntry=e):y.LSPluginEntry=v();const C=e=>{for(;e.firstChild;)e.removeChild(e.lastChild)};logseq.ready((async function(){let e=!1;const t=document.createElement("div");t.classList.add("unsplash-wrapper"),document.getElementById("app").appendChild(t),"dark"===(await logseq.App.getUserConfigs()).preferredThemeMode&&t.classList.add("dark"),logseq.App.onThemeModeChanged((({mode:e})=>{"dark"===e?t.classList.add("dark"):t.classList.remove("dark")}));const n=()=>{C(document.querySelector(".col-1")),C(document.querySelector(".col-2"))},r=()=>{let r=1,s="";e||((()=>{const e=document.createElement("form");e.classList.add("search-form"),e.innerHTML='\n\t\t\t<input class="search-input" type="search" value="" placeholder="Search Unsplash" />\n\t\t\t<button class="search-button" type="submit" >Search</button>\n\t\t',t.appendChild(e);const n=document.createElement("div");n.classList.add("result-container"),n.innerHTML='\n\t\t\t<div class="col-1"></div>\n\t\t\t<div class="col-2"></div>\n\t\t\t<button class="show-more">Show More</button>\n\t\t',t.appendChild(n)})(),e=!0),document.querySelector(".result-container").classList.add("hidden"),document.querySelector(".search-input").focus(),document.querySelector(".search-form").addEventListener("submit",(e=>{e.preventDefault(),r=1;const t=document.querySelector(".search-input").value;n(),s=t.trim(),o(s),document.querySelector(".result-container").classList.remove("hidden")})),document.querySelector(".show-more").addEventListener("click",(()=>{r++,o(s)}));async function o(e){try{const t=await(async e=>{const t=`?query=${encodeURIComponent(e)}&per_page=30&page=${r}&client_id=TjzU95V4JHVry7D_iigag7nKd940el7fMBB9KgBLpRY`,n=await fetch("https://api.unsplash.com/search/photos"+t);if(!n.ok)throw Error(n.statusText);return await n.json()})(e);i(t)}catch(e){console.log(e)}}const i=e=>{e.results.forEach(((e,t)=>{const r=e.alt_description,s=e.urls.small,o=e.user.name,i=e.user.links.html,a=document.createElement("div");a.classList.add("result-item"),a.innerHTML=`\n\t\t\t\t\t<img class="result-image" src="${s}" alt="${r}" />\n\t\t\t\t\t<a class="result-link" target="_blank" href="${i}" >${o}</a>\n\t\t\t\t`,a.querySelector("img").addEventListener("click",(()=>{logseq.Editor.insertAtEditingCursor(`![${r}](${s})`),logseq.Editor.exitEditingMode(),logseq.hideMainUI(),n(),document.querySelector(".search-input").value=""})),t%2==0?document.querySelector(".col-1").appendChild(a):document.querySelector(".col-2").appendChild(a)}))};document.addEventListener("keydown",(e=>{e.stopPropagation(),"Escape"===e.key&&(logseq.hideMainUI({restoreEditingCursor:!0}),n(),document.querySelector(".search-input").value="")}),!1),document.addEventListener("click",(e=>{e.target.closest(".unsplash-wrapper")||(logseq.hideMainUI({restoreEditingCursor:!0}),n(),document.querySelector(".search-input").value="")}))};logseq.Editor.registerSlashCommand("Unsplash",(async()=>{const{left:e,top:n,rect:s}=await logseq.Editor.getEditingCursorPosition();Object.assign(t.style,{top:n+s.top+"px",left:e+s.left+"px"}),logseq.showMainUI(),setTimeout((()=>r()),100)}))})).catch(console.error)}();